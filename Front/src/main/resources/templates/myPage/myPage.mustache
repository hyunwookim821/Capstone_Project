{{>layout/header}}
<div class="h-20 md:h-24"></div>

<!-- Main Content with Sidebar -->
<main class="container mx-auto px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-6">
        <!-- Left Sidebar -->
        <aside class="lg:w-64 flex-shrink-0">
            <div class="bg-white rounded-2xl shadow-lg p-4 sticky top-6">
                <h2 class="text-lg font-bold text-gray-800 mb-4 px-3">마이페이지</h2>
                <nav class="space-y-2">
                    <button onclick="showSection('profile')" class="menu-item active w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left" data-section="profile">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span>내 프로필</span>
                    </button>
                    <button onclick="showSection('resume')" class="menu-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left text-gray-700" data-section="resume">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>내 자소서 보기</span>
                    </button>
                    <button onclick="showSection('history')" class="menu-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left text-gray-700" data-section="history">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>면접 연습 이력</span>
                    </button>
                    <button onclick="showSection('documents')" class="menu-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left text-gray-700" data-section="documents">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                        <span>서류 피드백 이력</span>
                    </button>
                </nav>
            </div>
        </aside>

        <!-- Right Content Area -->
        <div class="flex-1">
            <!-- Profile Section -->
            <div id="profileSection" class="content-section">
                <!-- View Mode -->
                <div id="viewMode" class="bg-white rounded-2xl shadow-lg p-8 md:p-12 fade-in">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-800">내 프로필</h1>
                    </div>

                    <!-- Basic Information Section -->
                    <div class="mb-8">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <div class="w-8 h-8 gradient-icon rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </div>
                            기본 정보
                        </h2>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">이름</label>
                                <p id="view_name" class="text-gray-800 text-lg">홍길동</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">이메일</label>
                                <p id="view_email" class="text-gray-800 text-lg">hong@example.com</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">연락처</label>
                                <p id="view_phone" class="text-gray-800 text-lg">010-1234-5678</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">생년월일</label>
                                <p id="view_birthdate" class="text-gray-800 text-lg">1990-01-01</p>
                            </div>
                        </div>
                    </div>

                    <!-- Career Information Section -->
                    <div class="mb-8">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <div class="w-8 h-8 gradient-icon rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            경력 정보
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">희망 직무</label>
                                <p id="view_desired_position" class="text-gray-800">프론트엔드 개발자</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">희망 산업/분야</label>
                                <p id="view_desired_industry" class="text-gray-800">IT/소프트웨어</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">총 경력</label>
                                <p id="view_career_years" class="text-gray-800">3-5년</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">주요 경력 사항</label>
                                <p id="view_career_description" class="text-gray-800 whitespace-pre-line">React 기반 웹 애플리케이션 개발 경험 3년
                                    주요 프로젝트: 전자상거래 플랫폼 프론트엔드 개발</p>
                            </div>
                        </div>
                    </div>

                    <!-- Education & Skills Section -->
                    <div class="mb-8">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <div class="w-8 h-8 gradient-icon rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                            </div>
                            학력 및 스킬
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">최종 학력</label>
                                <p id="view_education" class="text-gray-800">대학교 졸업</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">전공</label>
                                <p id="view_major" class="text-gray-800">컴퓨터공학</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">보유 스킬 및 자격증</label>
                                <p id="view_skills" class="text-gray-800 whitespace-pre-line">JavaScript, React, TypeScript, HTML/CSS
                                    정보처리기사</p>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information Section -->
                    <div>
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <div class="w-8 h-8 gradient-icon rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </div>
                            추가 정보
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">자기소개</label>
                                <p id="view_introduction" class="text-gray-800 whitespace-pre-line">열정적인 프론트엔드 개발자로 사용자 경험을 최우선으로 생각합니다.</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">면접 준비 목표</label>
                                <p id="view_interview_goal" class="text-gray-800 whitespace-pre-line">대기업 프론트엔드 개발자 포지션 합격을 목표로 면접 실력을 향상시키고 싶습니다.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Edit Button at Bottom -->
                    <div class="mt-8 flex justify-center">
                        <button onclick="toggleEditMode()"
                                class="gradient-button text-white px-8 py-4 rounded-lg font-semibold hover-shadow transition-all flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            <span>프로필 수정하기</span>
                        </button>
                    </div>
                </div>

                <!-- Edit Mode -->
                <div id="editMode" class="bg-white rounded-2xl shadow-lg p-8 md:p-12 fade-in hidden">
                    <div class="flex justify-between items-center mb-8">
                        <h1 class="text-3xl font-bold text-gray-800">프로필 수정</h1>
                    </div>

                    <form id="profileForm" class="space-y-8">
                        <!-- Basic Information Section -->
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <div class="w-8 h-8 gradient-icon rounded-lg flex items-center justify-center mr-3">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </div>
                                기본 정보
                            </h2>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">이름 *</label>
                                    <input type="text" name="user_name" id="edit_name" required
                                           class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                                           placeholder="홍길동">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">이메일 *</label>
                                    <input type="email" name="email" id="edit_email" required
                                           class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                                           placeholder="example@email.com">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">연락처 *</label>
                                    <input type="tel" name="phone" id="edit_phone" required
                                           class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                                           placeholder="010-0000-0000">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">생년월일</label>
                                    <input type="date" name="birthdate" id="edit_birthdate"
                                           class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
                                </div>
                            </div>
                        </div>

                        <!-- Career Information Section -->
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <div class="w-8 h-8 gradient-icon rounded-lg flex items-center justify-center mr-3">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                                경력 정보
                            </h2>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">희망 직무 *</label>
                                    <input type="text" name="desired_position" id="edit_desired_position" required
                                           class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                                           placeholder="예: 프론트엔드 개발자, 마케팅 매니저">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">희망 산업/분야</label>
                                    <input type="text" name="desired_industry" id="edit_desired_industry"
                                           class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                                           placeholder="예: IT/소프트웨어, 금융, 제조">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">총 경력 *</label>
                                    <select name="career_years" id="edit_career_years" required
                                            class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
                                        <option value="">선택해주세요</option>
                                        <option value="신입">신입</option>
                                        <option value="1년 미만">1년 미만</option>
                                        <option value="1-3년">1-3년</option>
                                        <option value="3-5년">3-5년</option>
                                        <option value="5-10년">5-10년</option>
                                        <option value="10년 이상">10년 이상</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">주요 경력 사항</label>
                                    <textarea name="career_description" id="edit_career_description" rows="4"
                                              class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                                              placeholder="주요 담당 업무, 프로젝트 경험, 성과 등을 자유롭게 작성해주세요"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Education & Skills Section -->
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <div class="w-8 h-8 gradient-icon rounded-lg flex items-center justify-center mr-3">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                    </svg>
                                </div>
                                학력 및 스킬
                            </h2>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">최종 학력</label>
                                    <select name="education" id="edit_education"
                                            class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
                                        <option value="">선택해주세요</option>
                                        <option value="고등학교 졸업">고등학교 졸업</option>
                                        <option value="전문대 졸업">전문대 졸업</option>
                                        <option value="대학교 재학">대학교 재학</option>
                                        <option value="대학교 졸업">대학교 졸업</option>
                                        <option value="석사">석사</option>
                                        <option value="박사">박사</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">전공</label>
                                    <input type="text" name="major" id="edit_major"
                                           class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                                           placeholder="예: 컴퓨터공학, 경영학">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">보유 스킬 및 자격증</label>
                                    <textarea name="skills" id="edit_skills" rows="3"
                                              class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                                              placeholder="예: JavaScript, React, Python / 정보처리기사, TOEIC 900점"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information Section -->
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <div class="w-8 h-8 gradient-icon rounded-lg flex items-center justify-center mr-3">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </div>
                                추가 정보
                            </h2>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">자기소개</label>
                                    <textarea name="introduction" id="edit_introduction" rows="5"
                                              class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                                              placeholder="자신을 소개하는 간단한 글을 작성해주세요"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">면접 준비 목표</label>
                                    <textarea name="interview_goal" id="edit_interview_goal" rows="3"
                                              class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                                              placeholder="면접 시뮬레이터를 통해 달성하고 싶은 목표를 작성해주세요"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="flex flex-col sm:flex-row gap-4 pt-6">
                            <button type="submit"
                                    class="flex-1 gradient-button text-white px-8 py-4 rounded-lg font-semibold hover-shadow transition-all flex items-center justify-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>저장하기</span>
                            </button>
                            <button type="button" onclick="toggleEditMode()"
                                    class="flex-1 bg-gray-200 text-gray-700 px-8 py-4 rounded-lg font-semibold hover:bg-gray-300 transition-all">
                                취소
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Resume Section -->
            <div id="resumeSection" class="content-section hidden">
                <div class="bg-white rounded-2xl shadow-lg p-8 md:p-12 fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800">내 자소서 보기</h1>
                        <div class="flex space-x-2">
                            <button id="sort-asc" class="sort-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-semibold hover:bg-gray-300">오름차순</button>
                            <button id="sort-desc" class="sort-btn bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-blue-600">내림차순</button>
                        </div>
                    </div>

                    {{#resumes.isEmpty}}
                    <div class="text-center py-20">
                        <svg class="w-24 h-24 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p class="text-gray-500 text-lg">등록된 자소서가 없습니다.</p>
                        <a href="/document-feedback" class="inline-block gradient-button text-white px-6 py-3 rounded-lg font-semibold hover-shadow transition-all mt-6">
                            자소서 등록하기
                        </a>
                    </div>
                    {{/resumes.isEmpty}}
                    {{^resumes.isEmpty}}
                    <div id="resume-list-container" class="space-y-4">
                        <!-- Resume items will be rendered here by JavaScript -->
                    </div>
                    {{/resumes.isEmpty}}
                </div>
            </div>

            <!-- History Section -->
            <div id="historySection" class="content-section hidden">
                <div class="bg-white rounded-2xl shadow-lg p-8 md:p-12 fade-in">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">면접 연습 이력</h1>
                    {{#interviews.isEmpty}}
                    <div class="text-center py-20">
                        <svg class="w-24 h-24 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-gray-500 text-lg">아직 면접 연습 이력이 없습니다.</p>
                        <a href="/interview-practice" class="inline-block gradient-button text-white px-6 py-3 rounded-lg font-semibold hover-shadow transition-all mt-6">
                            면접 연습 시작하기
                        </a>
                    </div>
                    {{/interviews.isEmpty}}
                    {{^interviews.isEmpty}}
                    <div id="interview-list-container" class="space-y-4">
                        <!-- Interview items will be rendered here by JavaScript -->
                    </div>
                    {{/interviews.isEmpty}}
                </div>
            </div>

            <!-- Documents Section -->
            <div id="documentsSection" class="content-section hidden">
                <div class="bg-white rounded-2xl shadow-lg p-8 md:p-12 fade-in">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">서류 피드백 이력</h1>
                    {{#feedbackResumes.isEmpty}}
                    <div class="text-center py-20">
                        <svg class="w-24 h-24 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                        <p class="text-gray-500 text-lg">아직 서류 피드백 이력이 없습니다.</p>
                        <a href="/document-feedback" class="inline-block gradient-button text-white px-6 py-3 rounded-lg font-semibold hover-shadow transition-all mt-6">
                            서류 피드백 받기
                        </a>
                    </div>
                    {{/feedbackResumes.isEmpty}}
                    {{^feedbackResumes.isEmpty}}
                    <div id="feedback-resume-list-container" class="space-y-4">
                        <!-- Feedback resume items will be rendered here by JavaScript -->
                    </div>
                    {{/feedbackResumes.isEmpty}}
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<footer class="bg-gray-800 py-8 mt-20">
    <div class="container mx-auto px-6 text-center">
        <div class="text-gray-400 text-sm">
            © 2025 면접 시뮬레이터. All rights reserved.
        </div>
    </div>
</footer>

<script>
    // 1. Define functions in a globally accessible scope
    function showSection(sectionName) {
        document.querySelectorAll('.content-section').forEach(section => section.classList.add('hidden'));
        document.querySelectorAll('.menu-item').forEach(item => {
            item.classList.remove('active', 'bg-blue-50', 'text-blue-600');
            item.classList.add('text-gray-700');
        });
        const targetSection = document.getElementById(sectionName + 'Section');
        if(targetSection) {
            targetSection.classList.remove('hidden');
        }
        const activeItem = document.querySelector(`[data-section="${sectionName}"]`);
        if(activeItem) {
            activeItem.classList.add('active', 'bg-blue-50', 'text-blue-600');
            activeItem.classList.remove('text-gray-700');
        }
    }

    function toggleEditMode() {
        const viewMode = document.getElementById('viewMode');
        const editMode = document.getElementById('editMode');
        if (!viewMode || !editMode) return;

        viewMode.classList.toggle('hidden');
        editMode.classList.toggle('hidden');

        if (!editMode.classList.contains('hidden')) {
            loadEditData(window.currentUserData);
        } else {
            loadViewData(window.currentUserData);
        }
    }

    function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        const offset = date.getTimezoneOffset();
        const adjustedDate = new Date(date.getTime() - (offset*60*1000));
        return adjustedDate.toISOString().split('T')[0];
    }

    function loadViewData(data) {
        if (!data) return;
        document.getElementById('view_name').textContent = data.user_name || '-';
        document.getElementById('view_email').textContent = data.email || '-';
        document.getElementById('view_phone').textContent = data.phone || '-';
        document.getElementById('view_birthdate').textContent = data.birthdate ? formatDate(data.birthdate) : '-';
        document.getElementById('view_desired_position').textContent = data.desired_position || '-';
        document.getElementById('view_desired_industry').textContent = data.desired_industry || '-';
        document.getElementById('view_career_years').textContent = data.career_years || '-';
        document.getElementById('view_career_description').textContent = data.career_description || '-';
        document.getElementById('view_education').textContent = data.education || '-';
        document.getElementById('view_major').textContent = data.major || '-';
        document.getElementById('view_skills').textContent = data.skills || '-';
        document.getElementById('view_introduction').textContent = data.introduction || '-';
        document.getElementById('view_interview_goal').textContent = data.interview_goal || '-';
    }

    function loadEditData(data) {
        if (!data) return;
        document.getElementById('edit_name').value = data.user_name || '';
        document.getElementById('edit_email').value = data.email || '';
        document.getElementById('edit_phone').value = data.phone || '';
        document.getElementById('edit_birthdate').value = data.birthdate ? formatDate(data.birthdate) : '';
        document.getElementById('edit_desired_position').value = data.desired_position || '';
        document.getElementById('edit_desired_industry').value = data.desired_industry || '';
        document.getElementById('edit_career_years').value = data.career_years || '';
        document.getElementById('edit_career_description').value = data.career_description || '';
        document.getElementById('edit_education').value = data.education || '';
        document.getElementById('edit_major').value = data.major || '';
        document.getElementById('edit_skills').value = data.skills || '';
        document.getElementById('edit_introduction').value = data.introduction || '';
        document.getElementById('edit_interview_goal').value = data.interview_goal || '';
    }

    function formatDateTime(dateString) {
        if (!dateString) return '알 수 없음';
        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '알 수 없음';

            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');

            return `${year}-${month}-${day} ${hours}:${minutes}`;
        } catch (e) {
            console.error('Date formatting error:', e);
            return '알 수 없음';
        }
    }

    function renderResumes(resumes, container) {
        if (!container) return;
        container.innerHTML = '';
        if (!resumes || resumes.length === 0) return;

        resumes.forEach(resume => {
            const resumeEl = document.createElement('div');
            resumeEl.className = 'border rounded-lg';
            resumeEl.setAttribute('data-resume-id', resume.resume_id || resume.resumeId);
            const escapedContent = resume.content ? resume.content.replace(/</g, "&lt;").replace(/>/g, "&gt;") : '';

            // Handle both snake_case (from Python) and camelCase (from DTO)
            const resumeId = resume.resume_id || resume.resumeId;
            const createdAt = resume.created_at || resume.createdAt;
            const title = resume.title || '제목 없음';

            resumeEl.innerHTML = `
                <div class="p-4 flex justify-between items-center">
                    <div class="cursor-pointer flex-grow" onclick="document.querySelector('[data-target=\'#content-${resumeId}\']').click()">
                        <p class="font-semibold text-gray-800">${title}</p>
                        <p class="text-sm text-gray-500">업로드: ${formatDateTime(createdAt)}</p>
                    </div>
                    <div class="flex-shrink-0 ml-4">
                        <button class="toggle-resume-btn text-blue-500 hover:text-blue-700 font-semibold mr-4" data-target="#content-${resumeId}">보기</button>
                        <button class="delete-resume-btn text-red-500 hover:text-red-700 font-semibold" data-id="${resumeId}">삭제</button>
                    </div>
                </div>
                <div id="content-${resumeId}" class="hidden p-4 border-t bg-gray-50">
                    <pre class="whitespace-pre-wrap text-gray-700">${escapedContent}</pre>
                </div>
            `;
            container.appendChild(resumeEl);
        });
    }

    function renderInterviews(interviews, container) {
        if (!container) return;
        container.innerHTML = '';
        if (!interviews || interviews.length === 0) return;

        interviews.forEach(interview => {
            const interviewEl = document.createElement('div');
            interviewEl.className = 'border rounded-lg';

            const interviewId = interview.interview_id || interview.interviewId;
            const createdAt = interview.created_at || interview.createdAt;
            const resumeTitle = interview.resume_title || interview.resumeTitle || '제목 없음';
            const qaList = interview.qa_list || interview.qaList || [];
            const hasFeedback = interview.has_feedback || interview.hasFeedback;

            // QA 목록 HTML 생성
            let qaHtml = '';
            qaList.forEach((qa, index) => {
                const questionText = qa.question_text || qa.questionText || '';
                const answerText = qa.answer_text || qa.answerText || '';
                qaHtml += `
                    <div class="mb-4 pb-4 ${index < qaList.length - 1 ? 'border-b border-gray-200' : ''}">
                        <p class="font-semibold text-gray-800 mb-2">Q${index + 1}. ${questionText}</p>
                        <p class="text-gray-700 ml-4">A. ${answerText || '(답변 없음)'}</p>
                    </div>
                `;
            });

            interviewEl.innerHTML = `
                <div class="p-4 flex justify-between items-center">
                    <div class="cursor-pointer flex-grow" onclick="document.querySelector('[data-target=\'#interview-content-${interviewId}\']').click()">
                        <p class="font-semibold text-gray-800">${resumeTitle}</p>
                        <p class="text-sm text-gray-500">면접일: ${formatDateTime(createdAt)}</p>
                    </div>
                    <div class="flex-shrink-0 ml-4">
                        <button class="toggle-interview-btn text-blue-500 hover:text-blue-700 font-semibold" data-target="#interview-content-${interviewId}">보기</button>
                    </div>
                </div>
                <div id="interview-content-${interviewId}" class="hidden p-4 border-t bg-gray-50">
                    <div class="space-y-4">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">면접 기록</h3>
                        ${qaHtml}
                        ${hasFeedback ? `
                        <div class="mt-6 pt-4 border-t border-gray-300">
                            <a href="/interview/${interviewId}/results"
                               class="inline-block gradient-button text-white px-6 py-3 rounded-lg font-semibold hover-shadow transition-all">
                                최종 면접 피드백 보기
                            </a>
                        </div>
                        ` : '<p class="text-gray-500 text-sm mt-4">아직 피드백이 생성되지 않았습니다.</p>'}
                    </div>
                </div>
            `;
            container.appendChild(interviewEl);
        });
    }

    function renderFeedbackResumes(resumes, container) {
        if (!container) return;
        container.innerHTML = '';
        if (!resumes || resumes.length === 0) return;

        resumes.forEach(resume => {
            const resumeEl = document.createElement('a');
            resumeEl.href = `/resumes/history/${resume.resume_id || resume.resumeId}`;
            resumeEl.className = 'block p-4 border rounded-lg flex justify-between items-center hover:bg-gray-50 transition-colors';

            const title = resume.title || '제목 없음';
            const createdAt = resume.created_at || resume.createdAt;

            resumeEl.innerHTML = `
                <div>
                    <p class="font-semibold text-gray-800">${title}</p>
                    <p class="text-sm text-gray-500">생성일: ${formatDateTime(createdAt)}</p>
                </div>
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            `;
            container.appendChild(resumeEl);
        });
    }

    // 2. Main execution block
    document.addEventListener('DOMContentLoaded', function() {
        const authToken = "{{token}}";
        
        // CORRECT & SAFE DATA INJECTION
        const currentUserData = {{{userJson}}};
        let initialResumes = {{{resumesJson}}};
        let initialInterviews = {{{interviewsJson}}};

        if (!currentUserData) {
            console.error("currentUserData is null or undefined. Halting execution.");
            document.getElementById('profileSection').innerHTML = '<p class="text-red-500 p-8">사용자 정보가 없습니다. 다시 로그인해주세요.</p>';
            return;
        }

        window.currentUserData = currentUserData;

        // Attach event listeners
        const profileForm = document.getElementById('profileForm');
        if (profileForm) {
            profileForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const data = Object.fromEntries(formData.entries());
                for (const key in data) { if (data[key] === '') { data[key] = null; } }
                try {
                    const response = await fetch('/api/my-page/profile', {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + authToken },
                        body: JSON.stringify(data),
                    });
                    if (response.ok) {
                        window.currentUserData = await response.json();
                        alert('프로필이 성공적으로 저장되었습니다!');
                        toggleEditMode();
                    } else {
                        const errorData = await response.json();
                        alert('프로필 저장 실패: ' + (errorData.message || '알 수 없는 오류.'));
                    }
                } catch (error) {
                    console.error('Profile update error:', error);
                    alert('프로필 저장 중 오류가 발생했습니다.');
                }
            });
        }

        const sortAscBtn = document.getElementById('sort-asc');
        const sortDescBtn = document.getElementById('sort-desc');
        const resumeListContainer = document.getElementById('resume-list-container');

        function updateSortButtons(activeBtn) {
            [sortAscBtn, sortDescBtn].forEach(btn => {
                if (btn) {
                    btn.classList.remove('bg-blue-500', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                }
            });
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-200', 'text-gray-700');
                activeBtn.classList.add('bg-blue-500', 'text-white');
            }
        }

        if (sortAscBtn && sortDescBtn) {
            sortAscBtn.addEventListener('click', () => {
                console.log('Sorting ascending...');
                // Handle both snake_case and camelCase
                initialResumes.sort((a, b) => {
                    const dateA = new Date(a.created_at || a.createdAt);
                    const dateB = new Date(b.created_at || b.createdAt);
                    return dateA - dateB;
                });
                renderResumes(initialResumes, resumeListContainer);
                updateSortButtons(sortAscBtn);
            });
            sortDescBtn.addEventListener('click', () => {
                console.log('Sorting descending...');
                // Handle both snake_case and camelCase
                initialResumes.sort((a, b) => {
                    const dateA = new Date(a.created_at || a.createdAt);
                    const dateB = new Date(b.created_at || b.createdAt);
                    return dateB - dateA;
                });
                renderResumes(initialResumes, resumeListContainer);
                updateSortButtons(sortDescBtn);
            });
        }

        if (resumeListContainer) {
            resumeListContainer.addEventListener('click', async function(event) {
                const target = event.target;
                if (target.classList.contains('toggle-resume-btn')) {
                    const targetId = target.getAttribute('data-target');
                    const targetContent = document.querySelector(targetId);
                    if (targetContent) {
                        targetContent.classList.toggle('hidden');
                        target.textContent = targetContent.classList.contains('hidden') ? '보기' : '접기';
                    }
                }
                if (target.classList.contains('delete-resume-btn')) {
                    const resumeId = target.getAttribute('data-id');
                    if (confirm('정말로 이 자소서를 삭제하시겠습니까?')) {
                        try {
                            const response = await fetch(`/api/resumes/${resumeId}`, {
                                method: 'DELETE',
                                headers: { 'Authorization': 'Bearer ' + authToken }
                            });
                            if (response.ok) {
                                document.querySelector(`[data-resume-id="${resumeId}"]`).remove();
                                // Handle both snake_case and camelCase
                                initialResumes = initialResumes.filter(r => (r.resume_id || r.resumeId) != resumeId);
                                alert('삭제되었습니다.');
                            } else { throw new Error('삭제 실패'); }
                        } catch (error) {
                            console.error('Delete error:', error);
                            alert('삭제 중 오류 발생');
                        }
                    }
                }
            });
        }

        // Interview List Event Listeners
        const interviewListContainer = document.getElementById('interview-list-container');

        if (interviewListContainer) {
            interviewListContainer.addEventListener('click', function(event) {
                const target = event.target;
                if (target.classList.contains('toggle-interview-btn')) {
                    const targetId = target.getAttribute('data-target');
                    const targetContent = document.querySelector(targetId);
                    if (targetContent) {
                        targetContent.classList.toggle('hidden');
                        target.textContent = targetContent.classList.contains('hidden') ? '보기' : '접기';
                    }
                }
            });
        }

        // Initial Page Setup
        loadViewData(window.currentUserData);
        showSection('profile');

        // Render resumes
        if (initialResumes && initialResumes.length > 0) {
            // Sort by descending (newest first) initially
            initialResumes.sort((a, b) => {
                const dateA = new Date(a.created_at || a.createdAt);
                const dateB = new Date(b.created_at || b.createdAt);
                return dateB - dateA;
            });
            renderResumes(initialResumes, resumeListContainer);
            updateSortButtons(sortDescBtn);
        }

        // Render interviews
        if (initialInterviews && initialInterviews.length > 0) {
            renderInterviews(initialInterviews, interviewListContainer);
        }

        // Render feedback resumes
        const feedbackResumeListContainer = document.getElementById('feedback-resume-list-container');
        if (feedbackResumeListContainer && initialResumes) {
            // Filter resumes with feedback
            const feedbackResumes = initialResumes.filter(r =>
                (r.ai_feedback || r.aiFeedback) &&
                (r.ai_feedback || r.aiFeedback).trim() !== ''
            );
            if (feedbackResumes.length > 0) {
                renderFeedbackResumes(feedbackResumes, feedbackResumeListContainer);
            }
        }
    });
</script>
</body>
</html>
